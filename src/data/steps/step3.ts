import { Step } from '../types';

export const step3: Step = {
  "id": "3",
  "title": "Organizing Tests with describe() and test()",
  "initialCode": "// ============================================\r\n// STEP 3: Organizing Tests with describe()\r\n// ============================================\r\n\r\n// Shopping Cart Class\r\nclass ShoppingCart {\r\n  constructor() {\r\n    this.items = [];\r\n    this.discountCode = null;\r\n  }\r\n\r\n  addItem(item) {\r\n    if (!item.name || !item.price) {\r\n      throw new Error('Item must have name and price');\r\n    }\r\n    this.items.push(item);\r\n  }\r\n\r\n  removeItem(itemName) {\r\n    const index = this.items.findIndex(item => item.name === itemName);\r\n    if (index === -1) {\r\n      throw new Error('Item not found');\r\n    }\r\n    this.items.splice(index, 1);\r\n  }\r\n\r\n  getTotal() {\r\n    const subtotal = this.items.reduce((sum, item) => sum + item.price, 0);\r\n    if (this.discountCode === 'SAVE10') {\r\n      return subtotal * 0.9;\r\n    }\r\n    if (this.discountCode === 'SAVE20') {\r\n      return subtotal * 0.8;\r\n    }\r\n    return subtotal;\r\n  }\r\n\r\n  applyDiscount(code) {\r\n    this.discountCode = code;\r\n  }\r\n\r\n  getItemCount() {\r\n    return this.items.length;\r\n  }\r\n\r\n  clear() {\r\n    this.items = [];\r\n    this.discountCode = null;\r\n  }\r\n}\r\n\r\n// User Authentication Functions\r\nfunction login(username, password) {\r\n  if (!username || !password) {\r\n    throw new Error('Username and password required');\r\n  }\r\n  if (username === 'admin' && password === 'admin123') {\r\n    return { success: true, user: { username: 'admin', role: 'admin' } };\r\n  }\r\n  if (username === 'user' && password === 'user123') {\r\n    return { success: true, user: { username: 'user', role: 'user' } };\r\n  }\r\n  return { success: false, message: 'Invalid credentials' };\r\n}\r\n\r\nfunction logout(user) {\r\n  if (!user) {\r\n    throw new Error('No user to logout');\r\n  }\r\n  return { success: true, message: 'Logged out successfully' };\r\n}\r\n\r\nfunction resetPassword(email) {\r\n  if (!email || !email.includes('@')) {\r\n    throw new Error('Valid email required');\r\n  }\r\n  return { success: true, message: 'Password reset email sent' };\r\n}\r\n\r\n// ============================================\r\n// ORGANIZED TESTS WITH DESCRIBE()\r\n// ============================================\r\n\r\n// Example 1: Basic describe() grouping\r\ndescribe('ShoppingCart', () => {\r\n  test('creates empty cart', () => {\r\n    const cart = new ShoppingCart();\r\n    expect(cart.getItemCount()).toBe(0);\r\n  });\r\n\r\n  test('calculates total correctly', () => {\r\n    const cart = new ShoppingCart();\r\n    cart.addItem({ name: 'Book', price: 10 });\r\n    expect(cart.getTotal()).toBe(10);\r\n  });\r\n});\r\n\r\n// Example 2: Nested describe() blocks\r\ndescribe('ShoppingCart - Detailed', () => {\r\n  // Nested describe for adding items\r\n  describe('addItem()', () => {\r\n    it('adds item to cart', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      expect(cart.getItemCount()).toBe(1);\r\n    });\r\n\r\n    it('adds multiple items', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      cart.addItem({ name: 'Pen', price: 5 });\r\n      expect(cart.getItemCount()).toBe(2);\r\n    });\r\n\r\n    it('throws error for invalid item', () => {\r\n      const cart = new ShoppingCart();\r\n      expect(() => cart.addItem({})).toThrow('Item must have name and price');\r\n    });\r\n  });\r\n\r\n  // Nested describe for removing items\r\n  describe('removeItem()', () => {\r\n    it('removes existing item', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      cart.removeItem('Book');\r\n      expect(cart.getItemCount()).toBe(0);\r\n    });\r\n\r\n    it('throws error for non-existent item', () => {\r\n      const cart = new ShoppingCart();\r\n      expect(() => cart.removeItem('Book')).toThrow('Item not found');\r\n    });\r\n  });\r\n\r\n  // Nested describe for total calculation\r\n  describe('getTotal()', () => {\r\n    it('calculates total for single item', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      expect(cart.getTotal()).toBe(10);\r\n    });\r\n\r\n    it('calculates total for multiple items', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      cart.addItem({ name: 'Pen', price: 5 });\r\n      expect(cart.getTotal()).toBe(15);\r\n    });\r\n\r\n    it('applies 10% discount with SAVE10 code', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 100 });\r\n      cart.applyDiscount('SAVE10');\r\n      expect(cart.getTotal()).toBe(90);\r\n    });\r\n\r\n    it('applies 20% discount with SAVE20 code', () => {\r\n      const cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 100 });\r\n      cart.applyDiscount('SAVE20');\r\n      expect(cart.getTotal()).toBe(80);\r\n    });\r\n  });\r\n});\r\n\r\n// Example 3: Using it() vs test() - both work the same\r\ndescribe('User Authentication', () => {\r\n  // Using it() - more readable with describe\r\n  describe('login()', () => {\r\n    it('succeeds with valid admin credentials', () => {\r\n      const result = login('admin', 'admin123');\r\n      expect(result.success).toBe(true);\r\n      expect(result.user.role).toBe('admin');\r\n    });\r\n\r\n    it('succeeds with valid user credentials', () => {\r\n      const result = login('user', 'user123');\r\n      expect(result.success).toBe(true);\r\n      expect(result.user.role).toBe('user');\r\n    });\r\n\r\n    it('fails with invalid credentials', () => {\r\n      const result = login('wrong', 'wrong');\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it('throws error when username is missing', () => {\r\n      expect(() => login('', 'password')).toThrow('Username and password required');\r\n    });\r\n\r\n    it('throws error when password is missing', () => {\r\n      expect(() => login('username', '')).toThrow('Username and password required');\r\n    });\r\n  });\r\n\r\n  describe('logout()', () => {\r\n    it('logs out user successfully', () => {\r\n      const user = { username: 'admin' };\r\n      const result = logout(user);\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('throws error when no user provided', () => {\r\n      expect(() => logout(null)).toThrow('No user to logout');\r\n    });\r\n  });\r\n\r\n  describe('resetPassword()', () => {\r\n    it('sends reset email for valid email', () => {\r\n      const result = resetPassword('user@example.com');\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('throws error for invalid email', () => {\r\n      expect(() => resetPassword('invalid')).toThrow('Valid email required');\r\n    });\r\n\r\n    it('throws error for empty email', () => {\r\n      expect(() => resetPassword('')).toThrow('Valid email required');\r\n    });\r\n  });\r\n});\r\n\r\n// Example 4: Shared variables in test suite\r\ndescribe('ShoppingCart - Shared Variables', () => {\r\n  let cart; // Shared variable declaration\r\n\r\n  describe('with items', () => {\r\n    it('adds first item', () => {\r\n      cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      expect(cart.getItemCount()).toBe(1);\r\n    });\r\n\r\n    it('calculates correct total', () => {\r\n      cart = new ShoppingCart();\r\n      cart.addItem({ name: 'Book', price: 10 });\r\n      cart.addItem({ name: 'Pen', price: 5 });\r\n      expect(cart.getTotal()).toBe(15);\r\n    });\r\n  });\r\n});\r\n\r\n// Example 5: Deep nesting for complex hierarchies\r\ndescribe('E-commerce System', () => {\r\n  describe('ShoppingCart Module', () => {\r\n    describe('Item Management', () => {\r\n      describe('Adding Items', () => {\r\n        it('adds single item', () => {\r\n          const cart = new ShoppingCart();\r\n          cart.addItem({ name: 'Book', price: 10 });\r\n          expect(cart.getItemCount()).toBe(1);\r\n        });\r\n      });\r\n\r\n      describe('Removing Items', () => {\r\n        it('removes existing item', () => {\r\n          const cart = new ShoppingCart();\r\n          cart.addItem({ name: 'Book', price: 10 });\r\n          cart.removeItem('Book');\r\n          expect(cart.getItemCount()).toBe(0);\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('Pricing', () => {\r\n      describe('Discount Codes', () => {\r\n        it('applies SAVE10 discount', () => {\r\n          const cart = new ShoppingCart();\r\n          cart.addItem({ name: 'Book', price: 100 });\r\n          cart.applyDiscount('SAVE10');\r\n          expect(cart.getTotal()).toBe(90);\r\n        });\r\n      });\r\n    });\r\n  });\r\n});\n",
  "description": "## **Step 3: Organizing Tests with describe() and test()**\r\n\r\n#### **Topic 1: Grouping Tests with describe()**\r\n**Explanation:**\r\n`describe()` creates a block that groups related tests together. It takes two arguments:\r\n1. A string describing the group\r\n2. A callback function containing the tests\r\n\r\n**Benefits:**\r\n- Organizes tests logically\r\n- Makes test output more readable\r\n- Allows scoped setup/teardown\r\n- Groups related functionality\r\n\r\n**Syntax:**\r\n```javascript\r\ndescribe('description of the group', () => {\r\n  test('test 1', () => { /* ... */ });\r\n  test('test 2', () => { /* ... */ });\r\n});\r\n```\r\n\r\n---\r\n\r\n#### **Topic 2: Nested describe() Blocks**\r\n**Explanation:**\r\nYou can nest `describe()` blocks to create hierarchical test structures. This is useful for testing classes with multiple methods or complex modules.\r\n\r\n```javascript\r\ndescribe('Calculator', () => {\r\n  describe('addition', () => {\r\n    test('adds positive numbers', () => { /* ... */ });\r\n    test('adds negative numbers', () => { /* ... */ });\r\n  });\r\n  \r\n  describe('subtraction', () => {\r\n    test('subtracts positive numbers', () => { /* ... */ });\r\n    test('subtracts negative numbers', () => { /* ... */ });\r\n  });\r\n});\r\n```\r\n\r\n**Output:**\r\n```\r\nCalculator\r\n  addition\r\n    ✓ adds positive numbers\r\n    ✓ adds negative numbers\r\n  subtraction\r\n    ✓ subtracts positive numbers\r\n    ✓ subtracts negative numbers\r\n```\r\n\r\n---\r\n\r\n#### **Topic 3: Test Organization Best Practices**\r\n**Explanation:**\r\n\r\n**1. Group by Feature/Module**\r\n```javascript\r\ndescribe('User Authentication', () => {\r\n  // All auth-related tests\r\n});\r\n```\r\n\r\n**2. Group by Method/Function**\r\n```javascript\r\ndescribe('UserService', () => {\r\n  describe('createUser()', () => { /* ... */ });\r\n  describe('deleteUser()', () => { /* ... */ });\r\n});\r\n```\r\n\r\n**3. Use Descriptive Names**\r\n- Good: `'should return user when valid ID is provided'`\r\n- Bad: `'test1'`\r\n\r\n**4. One Assertion per Test (when possible)**\r\n- Makes failures easier to diagnose\r\n- Tests are more focused\r\n\r\n---\r\n\r\n#### **Topic 4: Using it() vs test()**\r\n**Explanation:**\r\n`it()` and `test()` are aliases - they do exactly the same thing. Choose based on readability:\r\n\r\n**test()** - More explicit\r\n```javascript\r\ntest('adds two numbers', () => {\r\n  expect(add(1, 2)).toBe(3);\r\n});\r\n```\r\n\r\n**it()** - More readable with describe()\r\n```javascript\r\ndescribe('Calculator', () => {\r\n  it('adds two numbers', () => {\r\n    expect(add(1, 2)).toBe(3);\r\n  });\r\n  // Reads as: \"Calculator it adds two numbers\"\r\n});\r\n```\r\n\r\n**Convention:** Use `it()` inside `describe()` blocks, use `test()` for standalone tests.\r\n\r\n---\r\n\r\n#### **Topic 5: Shared Variables in Test Suites**\r\n**Explanation:**\r\nVariables declared in a `describe()` block are shared across all tests in that block. This is useful for setup data.\r\n\r\n```javascript\r\ndescribe('User tests', () => {\r\n  let user; // Shared variable\r\n  \r\n  test('test 1', () => {\r\n    user = { name: 'John' };\r\n    expect(user.name).toBe('John');\r\n  });\r\n  \r\n  test('test 2', () => {\r\n    // 'user' is accessible here\r\n    // Note: Tests run independently, so 'user' from test 1 doesn't persist\r\n  });\r\n});\r\n```\r\n\r\n**Important:** Each test should be independent! Don't rely on shared state between tests.\r\n\r\n---\r\n\r\n#### **Topic 6: Test Hierarchy Structure**\r\n**Explanation:**\r\nA well-structured test suite follows a logical hierarchy:\r\n\r\n```\r\nTest File (UserService.test.js)\r\n└── describe('UserService')\r\n    ├── describe('Constructor')\r\n    │   ├── it('creates instance with default values')\r\n    │   └── it('creates instance with provided values')\r\n    ├── describe('createUser()')\r\n    │   ├── it('creates user with valid data')\r\n    │   ├── it('throws error with invalid email')\r\n    │   └── it('throws error with duplicate username')\r\n    └── describe('deleteUser()')\r\n        ├── it('deletes existing user')\r\n        └── it('throws error for non-existent user')\r\n```\r\n\r\n**Benefits:**\r\n- Easy to navigate\r\n- Clear organization\r\n- Related tests grouped together\r\n- Easy to skip/run specific groups"
};
